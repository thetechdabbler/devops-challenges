groups:
  - name: slo-recording-rules
    rules:
      - record: job:http_requests:error_ratio_rate5m   # FIX 1: correct naming convention
        expr: |
          sum(rate(http_requests_total{status=~"5.."}[5m]))
          /
          sum(rate(http_requests_total[5m]))
        labels:                           # FIX 5: add labels block
          job: my-app
          slo: availability

      - record: job:http_requests:error_ratio_rate1h   # FIX 1: correct naming convention
        expr: |
          sum(rate(http_requests_total{status=~"5.."}[1h]))
          /
          sum(rate(http_requests_total[1h]))
        labels:
          job: my-app
          slo: availability

      - record: job:http_requests:error_budget_remaining
        expr: 1 - 0.999                   # FIX 3: correct positive error budget

  - name: slo-alerts
    rules:
      - alert: HighBurnRate
        expr: |
          job:http_requests:error_ratio_rate1h > (14.4 * 0.001)
          and
          job:http_requests:error_ratio_rate5m > (14.4 * 0.001)   # FIX 2: use 5m recording rule
        for: 2m                           # FIX 4: fast-burn alert fires quickly
        labels:
          severity: critical
          slo: availability
        annotations:
          summary: "High SLO burn rate â€” budget exhausted in < 1h"
          description: "Error rate is {{ $value | humanizePercentage }}"
